Fingerboard=function(a,b){var c=function(){var a={noteclick:[],notehover:[],modelchange:[]},b={broadcast:function(b,c){a[b]&&a[b].forEach(function(a){a(c())})},on:function(b,c){a[b]||(a[b]=[]),a[b].push(c)}};for(var c in a)b[c]=function(b){a[c].push(b)};return b}();for(var d in c)this[d]=c[d];{var e=new Fingerboard.Model(b,c);new Fingerboard.View(a,e,c)}this.set=e.set,this.getNoteFor=function(a,b){return getNoteFor(a,b).clone()},this.setNoteFor=function(a,b,d){var e=getNoteFor(a,b);for(var f in d)e[f]=d[f];c.broadcast("modelchange",function(){return d})},this.frets=e.frets,this.strings=e.strings,this.select=function(a){e.select(a),c.broadcast("modelchange",function(){return a})},this.notationFromFreqId=e.notationFromFreqId},function(a){a.ContextWrapper=function(a){var b=this,c=function(a,c){return function(){return a[c].apply(a,arguments),b}},d=function(a,c){return function(d){return a[c]=d,b}};for(var e in a)b[e]="function"==typeof a[e]?c(a,e):d(a,e);b.context=a,b.begin=function(){return a.beginPath(),b},b.beginAt=function(c,d){return a.beginPath(),a.moveTo(c,d),b},b.color=function(c){return a.fillStyle=c,b},b.get=function(b){return a[b]}}}(Fingerboard),function(a){a.Clonify=Clonify=function(a){switch(typeof a){case"undefined":return;case"number":return Number(a);case"object":if(Array.isArray(a))return a.map(function(a){return Clonify(a)});var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=Clonify(a[c]));return b;case"string":return String(a);case"function":var d=function(){return a.apply(this,arguments)};for(var c in a)a.hasOwnProperty(c)&&(d[c]=Clonify(a[c]));return d;case"date":return new Date(a.valueOf());case"boolean":return Boolean(a)}throw"Type "+typeof a+" not clonable"},a.Polymorphy=function(){},a.Polymorphy.extends=function(a){var b,c=function(a){for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])a[c]=Clonify(arguments[b][c]);return a},d=this;b=a&&"constructor"in a?a.constructor:function(){return d.apply(this,arguments)};var e=function(){this.constructor=b};return e.prototype=d.prototype,b.prototype=new e,a&&c(b.prototype,a),b.__super__=d.prototype,b},a.Polymorphy.prototype.clone=function(){return Clonify(this)}}(Fingerboard),function(a,b,c){function d(a,b,c,d){this.x1=a?a:-1,this.y1=b?b:-1,this.x2=c?c:-1,this.y2=d?d:-1,this.isPointWithinBounds=function(a,b){return a>this.x1&&a<this.x2&&b>this.y1&&b<this.y2}}var e=c.extends({constructor:function(a,b){this.fret=a,this.string=b,this.selector="",this.dimension=new d,this.interval={}}});a.Model=function(a,c){var d,f=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];this.settings=settings={notation:b(f),selectors:{}};var g=function(a){if("string"==typeof a){if("["===a[0])return JSON.parse(a);if(-1!==a.indexOf(","))return a.split(",").map(function(a){return Number(a)});throw"Cannot process array argument "+a}return a};this.getNoteFor=getNoteFor=function(a,b){return d[a][b-1]},this.frets=function(){return d.length},this.strings=strings=function(){return d[0].length},this.find=find=function(a){var b=void 0;return this.forEach(function(c,d,e){return a(c,d,e)===!0?(b=e,!1):void 0}),b},this.forEach=forEach=function(a){for(var b=0;b<d.length;b++)for(var c=1;c<=d[0].length;c++)if(a(b,c,getNoteFor(b,c))===!1)return},this.select=select=function(a){"scale"===a&&forEach(function(a,b,c){c.selector=1===c.rootedValue?"tonic":c.scaleValue?"selected":""})};var h=function(a,b){a||(a=d.length-1||15),b||(b=d[0].length||6),d=[];for(var c=0;a>=c;c++){d[c]=[];for(var f=1;b>=f;f++)d[c][f-1]=new e(c,f,this)}},i=function(a){var b=a.notation||settings.notation,c=a.maxIndex||8,d=g(a.tuning)||settings.tuning,e=1,h=0,i=[],j=b.length||a.scaleLength;if(!d){if(!b.every(function(a,b){return f[b]===a})||6!==strings())throw"Interval needs more arguments.";var k=function(a,b){return 12*b+f.indexOf(a)};d=[k("E",2),k("A",2),k("D",3),k("G",3),k("B",3),k("E",4)]}for(var l=0;j*(c+1)>l;l++)i.push({value:e,index:h,freqId:l+1,notation:b[e-1]||void 0}),e>=j?(e=1,h++):e++;d=d.reverse(),forEach(function(a,b,c){c.interval=i[d[b-1]+a]}),settings.tuning=d,settings.notation=b,settings.scaleLength=j},j=function(a){var b=settings.scaleLength;forEach(function(c,d,e){e.rootedValue=e.interval.value-a+1,e.rootedValue<1&&(e.rootedValue+=b)}),settings.root=a};this.buildScale=buildScale=function(a){var b,c=a&&g(a.values)||settings.scale,d=(settings.scaleLength,[]);(a&&a.root||!settings.root)&&j(a&&a.root||settings.root||1),c.forEach(function(a,b){d[a]=b+1}),forEach(function(a,c,e){e.scaleValue=(b=d[e.rootedValue])?b:void 0}),settings.scale=c,a&&a.select&&select("scale")},this.set=set=function(a){if(a.selectors)for(var d in a.selectors)settings.selectors[d]=a.selectors[d];(a.strings||a.frets)&&h(a.frets,a.strings),a.interval&&i(a.interval),a.scale&&buildScale(a.scale),a.interval&&!a.scale&&(j(settings.root),buildScale(),select("scale")),c.broadcast("modelchange",function(){return b(a)})},this.notationFromFreqId=function(a){var b=settings.notation.length;return settings.notation[a%b]+""+Math.floor(a/b)},this.get=get=function(){if(1===arguments.length)return b(settings[arguments[0]]);for(var a={},c=0;c<arguments.length;c++)a[arguments[c]]=b(settings[arguments[c]]);return a},a?set(a):h()}}(Fingerboard,Fingerboard.Clonify,Fingerboard.Polymorphy),function(a,b){a.View=function(a,c,d){function e(a,b,c,d){l.beginAt(a-c/2,b).lineTo(a,b-d/2).lineTo(a+c/2,b).lineTo(a,b+d/2).fillStyle(m.inlays).fill()}function f(){var a,b,d,f,g=i/(2*c.frets()),h=i-g,k=h/(c.frets()-2),n=j/c.strings(),o=c.settings.selectors,p=2*Math.PI,q=n>g?g/4:n/4;l.lineWidth=.5,c.forEach(function(c,h,r){if(b=c?(c-1)*k+g:1,d=b+k-1,a=(h-1)*n+n/2,f=b+(c?k:g)/2,r.dimension.x1=b,r.dimension.y1=a-n/2,r.dimension.x2=d,r.dimension.y2=a+n/2,0===c&&l.beginPath().fillStyle(m.strings).moveTo(0,a).lineTo(i,a).stroke(),1==h)switch(l.beginPath().fillStyle(m.frets).moveTo(b,0).lineTo(b,j).stroke(),c){case 3:case 5:case 7:case 9:e(f,j/2,3*q,6*q);break;case 12:e(f,j/3,3*q,6*q),e(f,2*(j/3),3*q,6*q)}""!==r.selector&&(color=o[r.selector])&&l.beginPath().color(color).arc(f,a,q,0,p).fill()})}function g(){i=a.width(),j=a.height(),l.get("canvas").height=j,l.get("canvas").width=i}function h(){g(),l.begin().clearRect(0,0,i,j).fill(),f()}var i,j,k=a[0],l=new b(k.getContext("2d"));c.settings.selectors.selected="gray",c.settings.selectors.tonic="firebrick";var m={strings:"gray",inlays:"#D1A319",frets:"gray"};k.style["user-select"]="none",k.style["-webkit-user-select"]="none",k.style["-moz-user-select"]="none",k.style["border-style"]="solid",k.style.color="gray",g(),f(),a.click(function(){d.broadcast("noteclick",function(){return c.mouseHoveredNote.clone()})});var n,o,p=!1;a.mousemove(function(a){if(n=a.pageX-$(this).offset().left,o=a.pageY-$(this).offset().top,p=c.mouseHoveredNote?!c.mouseHoveredNote.dimension.isPointWithinBounds(n,o):!0){var b=c.find(function(a,b,c){return c.dimension.isPointWithinBounds(n,o)});b&&(c.mouseHoveredNote=b,d.broadcast("notehover",function(){return c.mouseHoveredNote.clone()}))}}),$(window).resize(h),d.modelchange(h)}}(Fingerboard,Fingerboard.ContextWrapper);