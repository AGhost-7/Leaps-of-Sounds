(function(){var a,b,c,d,e,f,g,h,i=[].slice,j=function(a,b){return function(){return a.apply(b,arguments)}};h=function(){var a,b,c;b={noteclick:[],notehover:[],modelchange:[]},c={broadcast:function(){var a,c,d,e,f,g,h;for(a=arguments[0],d=2<=arguments.length?i.call(arguments,1):[],g=b[a],h=[],e=0,f=g.length;f>e;e++)c=g[e],h.push(c.apply(void 0,d));return h},on:function(a,c){return b[a].push(c)}};for(a in b)c[a]=function(a){return function(c){return b[a].push(c)}}(a);return c},b=function(){function a(a,b){var c,e,g,i;c=h();for(e in c)this[e]=c[e];b=b||{},g=new d(b.model||{},c),i=new f(b.view||{},a,g,c),i.updateDimensions(),i.paint(),this.forEach=function(a){return g.forEach(function(b,c,d){return a(b,c,d)})},this.set=function(a){return a.view&&i.set(a.view),a.model&&g.set(a.model),a.view&&!a.model?i.repaint():void 0}}return a}(),window.Fingerboard=b,a=function(){function a(a){var b;for(b in a)"webkitImageSmoothingEnabled"!==b&&("function"==typeof a[b]?this[b]=function(b){return function(){return a[b].apply(a,arguments),this}}(b):this[b]=function(b){return function(c){return a[b]=c,this}}(b));this.context=a}return a.prototype.begin=function(){return this.context.beginPath(),this},a.prototype.beginAt=function(a,b){return this.context.beginPath(),this.context.moveTo(a,b),this},a.prototype.color=function(a){return this.context.fillStyle=a,this},a.prototype.get=function(a){return this.context[a]},a}(),d=function(){function a(a,b){this.events=b,this.notes=[[]],this.notation=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],this.root=1,this.tuning=[28,33,38,43,47,52],this.scale=void 0,this.scaleLength=this.notation.length,this.strings=6,this.frets=16,this.maxIndex=8,this.set(a)}return a.prototype.fill=function(){var a,b,c,d,f;for(this.notes=[],f=[],a=c=0,d=this.frets;d>=0?d>=c:c>=d;a=d>=0?++c:--c)this.notes[a]=[],f.push(function(){var c,d,f;for(f=[],b=c=1,d=this.strings;d>=1?d>=c:c>=d;b=d>=1?++c:--c)f.push(this.notes[a][b-1]=new e(a,b));return f}.call(this));return f},a.prototype.buildInterval=function(){var a,b,c;if(this.tuning.length!==this.strings)throw"Tuning is invalid for the number of strings given.";return b=this.scaleLength*(this.maxIndex+1)-1,a=function(){c=[];for(var a=0;b>=0?b>=a:a>=b;b>=0?a++:a--)c.push(a);return c}.apply(this).map(function(a){return function(b){var c,d,e;return c=b+1,d=Math.floor(b/a.scaleLength),e=c-d*a.scaleLength,{value:e,index:d,freqId:c,notation:a.notation[e-1]}}}(this)),this.forEach(function(b){return function(c,d,e){var f,g,h;f=a[b.tuning[e-1]+d],h=[];for(g in f)h.push(c.interval[g]=f[g]);return h}}(this))},a.prototype.buildRootedValue=function(){return this.forEach(function(a){return function(b,c,d){return b.interval.shift=b.interval.value-a.root+1,b.interval.shift<1?b.interval.shift+=a.scaleLength:void 0}}(this))},a.prototype.buildScale=function(){var a,b,c;return a=void 0,b=function(){c=[];for(var a=1,b=this.scaleLength;b>=1?b>=a:a>=b;b>=1?a++:a--)c.push(a);return c}.apply(this).map(function(a){return function(b){return a.scale.indexOf(b)+1}}(this)),this.forEach(function(c){return function(c,d,e){return(a=b[c.interval.shift-1])?c.interval.degree=a:c.interval.degree=void 0}}(this))},a.prototype.set=function(a){var b,c,d,e,f,g;if(void 0===a)throw"Oye, forgot something? I need an options object.";return a.strings&&(this.strings=a.strings),a.frets&&(this.frets=a.frets),a.tuning&&(this.tuning=this.asJSArray(a.tuning)),a.interval&&(f=a.interval,f.notation&&(this.notation=this.asJSArray(f.notation),this.scaleLength=this.notation.length),f.maxIndex&&(this.maxIndex=f.maxIndex)),a.scale&&(g=a.scale,g.values&&(this.scale=this.asJSArray(g.values)),g.root&&(this.root=g.root)),e=a.strings||a.frets||!this.notes[0][0],b=a.tuning||a.interval||e,c=b||a.scale&&a.scale.root,d=a.scale||c&&this.scale,e&&this.fill(),b&&this.buildInterval(),c&&this.buildRootedValue(),d&&this.buildScale(),e||b||c||d?this.events.broadcast("modelchange"):void 0},a.prototype.asJSArray=function(a){if("string"==typeof a){if("["===a[0])return JSON.parse(a);if(-1!==a.indexOf(","))return a.split(",").map(function(a){if(isNaN(a))throw"Invalid array input.";return Number(a)});throw"Could not parse array argument"}return a},a.prototype.forEach=function(a){var b,c,d,e,f,g,h,i,j;for(j=this.notes,b=f=0,h=j.length;h>f;b=++f)for(c=j[b],e=g=0,i=c.length;i>g;e=++g)if(d=c[e],a(d,b,e+1)===!1)return},a.prototype.find=function(a){var b;return b=void 0,this.forEach(function(c,d,e){return a(c,d,e)===!0?(b=c,!1):void 0}),b},a}(),c=function(){function a(){this.freqId=-1,this.index=-1,this.value=-1,this.notation="",this.shift=-1,this.degree=-1}return a}(),e=function(){function a(a,b){this.fret=a,this.string=b,this.interval=new c}return a.prototype.log=function(){return console.log(this)},a}(),f=function(){function b(b,c,d,e){this.canvas=c,this.model=d,this.events=e,this.repaint=j(this.repaint,this),this.onMouseMove=j(this.onMouseMove,this),this.onMouseClick=j(this.onMouseClick,this),this.context=new a(this.canvas.getContext("2d")),this.canvas.style["user-select"]="none",this.canvas.style["-webkit-user-select"]="none",this.canvas.style["-moz-user-select"]="none",this.colors={strings:"gray",inlays:"#D1A319",frets:"gray"},window.addEventListener("resize",this.repaint),this.canvas.addEventListener("resize",this.repaint),this.events.modelchange(this.repaint),this.canvas.addEventListener("click",this.onMouseClick),this.canvas.addEventListener("mousemove",this.onMouseMove),this.set(b)}return b.prototype.endArc=2*Math.PI,b.prototype.set=function(a){var b;return a.drawInlay&&(this.drawInlay=a.drawInlay),a.drawSelector&&(this.drawSelector=a.drawSelector),a.drawString&&(this.drawString=a.drawString),a.drawFret&&(this.drawFret=a.drawFret),a.colors&&(b=a.colors,b.strings&&(this.colors.strings=b.strings),b.frets&&(this.colors.frets=b.frets),b.inlays)?this.colors.inlays=b.inlays:void 0},b.prototype.relativePosition=function(a){var b,c,d,e;return e=document.documentElement,b=this.canvas.getBoundingClientRect(),c=b.left-window.pageXOffset-e.clientLeft,d=b.top-window.pageYOffset-e.clientTop,{x:a.pageX-c,y:a.pageY-d}},b.prototype.pinpointNote=function(a,b){var c,d,e,f,g,h;return h=this.fretWidths(),f=h.openFretWidth,d=h.fretWidth,c=f>a?0:Math.floor((a-f)/d)+1,e=this.height/this.model.strings,g=this.model.strings-Math.floor(b/e),{string:g,fret:c}},b.prototype.onMouseClick=function(a){var b,c,d,e,f,g,h;return g=this.relativePosition(a),e=g.x,f=g.y,h=this.pinpointNote(e,f),d=h.string,b=h.fret,c=this.model.notes[b][d-1],this.events.broadcast("noteclick",c)},b.prototype.onMouseMove=function(a){var b,c,d,e,f,g;return f=this.relativePosition(a),d=f.x,e=f.y,g=this.pinpointNote(d,e),b=g.fret,c=g.string,this.hoveredNote&&this.hoveredNote.fret===b&&this.hoveredNote.string===c||!this.model.notes[b]||!this.model.notes[b][c-1]?void 0:(this.hoveredNote=this.model.notes[b][c-1],this.events.broadcast("notehover",this.hoveredNote))},b.prototype.updateDimensions=function(){return this.width=this.canvas.offsetWidth,this.height=this.canvas.offsetHeight,this.context.get("canvas").height=this.height,this.context.get("canvas").width=this.width},b.prototype.drawInlay=function(a,b,c,d,e,f){return a.color(b).beginPath().moveTo(c-e/2,d).lineTo(c,d-f/2).lineTo(c+e/2,d).lineTo(c,d+f/2).fill()},b.prototype.drawSelector=function(a,b,c,d,e){var f;return b.interval.degree?(f=1===b.interval.degree?"firebrick":"gray",a.beginPath().color(f).arc(c,d,e,0,this.endArc).fill()):void 0},b.prototype.drawString=function(a,b,c,d,e){return a.beginPath().lineWidth(1).fillStyle(b).moveTo(e,d).lineTo(c,d).stroke()},b.prototype.drawFret=function(a,b,c,d,e){return a.lineWidth(1===b?5:1),b>0?a.beginPath().fillStyle(e).moveTo(c,0).lineTo(c,d).stroke():void 0},b.prototype.fretWidths=function(){var a,b,c;return c=this.width/(2*this.model.frets),b=this.width-c,a=b/(this.model.frets-2),{openFretWidth:c,fretWidth:a}},b.prototype.paint=function(){var a,b,c,d,e,f,g,h,i;return i=this.fretWidths(),f=i.openFretWidth,d=i.fretWidth,e=this.height/this.model.strings,g=e>f?f/4:e/4,h=0,c=0,b=0,a=0,this.model.forEach(function(a){return function(h,i,j){var k,l,m;if(c=i?(i-1)*d+f:1,b=c+d-1,l=a.model.strings-j+1,m=(l-1)*e+e/2,k=c+(i?d:f)/2,0===i&&a.drawString(a.context,a.colors.strings,a.width,m,f),1===j)switch(a.drawFret(a.context,i,c,a.height,a.colors.frets),i){case 3:case 5:case 7:case 9:a.drawInlay(a.context,a.colors.inlays,k,a.height/2,3*g,6*g);break;case 12:a.drawInlay(a.context,a.colors.inlays,k,a.height/3,3*g,6*g),a.drawInlay(a.context,a.colors.inlays,k,2*(a.height/3),3*g,6*g)}return a.drawSelector(a.context,h,k,m,g)}}(this))},b.prototype.repaint=function(){return this.updateDimensions(),this.context.begin().clearRect(0,0,this.width,this.height).fill(),this.paint()},b}(),null==b.View&&(b.View={}),g=2*Math.PI,b.View.selectors={"default":function(a){var b,c,d,e;return e=a.tonicColor,c=a.elseColor,d=a.ratio,null==d&&(d=1),b=void 0,null==e&&(e="firebrick"),null==c&&(c="gray"),function(a,f,h,i,j){return f.interval.degree?(b=1===f.interval.degree?e:c,a.begin().color(b).arc(h,i,j*d,0,g).fill()):void 0}},notationDots:function(a){var b,c,d,e,f,h,i,j;return i=a.tonicColor,c=a.elseColor,h=a.textColor,j=a.withIndex,e=a.ratio,d=a.font,null==e&&(e=1.4),null==d&&(d="600 9px tahoma"),null==i&&(i="fireBrick"),null==c&&(c="gray"),null==h&&(h="white"),null==j&&(j=!0),b=void 0,f=void 0,function(a,k,l,m,n){return k.interval.degree?(b=1===k.interval.degree?i:c,a.begin().color(b).arc(l,m,n*e,0,g).fill(),f=j?k.interval.notation+k.interval.index:k.interval.notation,a.begin().color(h).textAlign("center").textBaseline("middle").font(d).fillText(f,l,m)):void 0}},degreeDots:function(a){var b,c,d,e,f,h;return h=a.tonicColor,c=a.elseColor,f=a.textColor,e=a.ratio,d=a.font,null==e&&(e=1.2),null==d&&(d="600 9px tahoma"),null==h&&(h="fireBrick"),null==c&&(c="gray"),null==f&&(f="white"),b=void 0,function(a,i,j,k,l){return i.interval.degree?(b=1===i.interval.degree?h:c,a.begin().color(b).arc(j,k,l*e,0,g).fill(),a.begin().color(f).textAlign("center").textBaseline("middle").font(d).fillText(""+i.interval.degree,j,k)):void 0}}}}).call(this);